<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulnérabilité d'Upload de Fichiers</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            margin-top: 50px;
        }

        .code-block {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="text-center mb-4">Vulnérabilité d'Upload de Fichiers</h1>

        <!-- Section Explication -->
        <section>
            <h2>Qu'est-ce que la vulnérabilité d'upload de fichiers ?</h2>
            <p>
                La vulnérabilité d'upload de fichiers se produit lorsqu'une application web permet à un utilisateur de
                téléverser un fichier sans valider correctement son type, sa taille ou son contenu. Cela peut permettre
                à un attaquant de téléverser un fichier malveillant (comme un script PHP ou un shell) et d'exécuter du
                code arbitraire sur le serveur.
            </p>
        </section>

        <!-- Section Exemple de Code Vulnérable -->
        <section>
            <h2>Exemple de Code Vulnérable</h2>
            <div class="code-block">
                <pre><code>&lt;?php
if ($_FILES['file']['error'] === UPLOAD_ERR_OK) {
    $uploadDir = 'uploads/';
    $uploadFile = $uploadDir . basename($_FILES['file']['name']);
    move_uploaded_file($_FILES['file']['tmp_name'], $uploadFile);
    echo "Fichier téléversé avec succès !";
}
?&gt;</code></pre>
            </div>
            <p>
                Ce code ne valide pas le type de fichier ou son contenu. Un attaquant peut téléverser un fichier PHP
                malveillant et l'exécuter sur le serveur.
            </p>
        </section>

        <!-- Section Comment Patcher la Vulnérabilité -->
        <section>
            <h2>Comment Patcher la Vulnérabilité ?</h2>
            <p>
                Pour sécuriser l'upload de fichiers, vous pouvez :
            </p>
            <ul>
                <li>Valider le type de fichier (extension et MIME type).</li>
                <li>Renommer le fichier téléversé pour éviter l'exécution de scripts.</li>
                <li>Limiter la taille du fichier.</li>
                <li>Stocker les fichiers hors de la racine web.</li>
            </ul>
            <div class="code-block">
                <pre><code>&lt;?php
$allowedTypes = ['image/jpeg', 'image/png'];
$maxFileSize = 2 * 1024 * 1024; // 2 Mo

if ($_FILES['file']['error'] === UPLOAD_ERR_OK) {
    $fileType = $_FILES['file']['type'];
    $fileSize = $_FILES['file']['size'];

    if (in_array($fileType, $allowedTypes) && $fileSize <= $maxFileSize) {
        $uploadDir = 'uploads/';
        $uploadFile = $uploadDir . uniqid() . '_' . basename($_FILES['file']['name']);
        move_uploaded_file($_FILES['file']['tmp_name'], $uploadFile);
        echo "Fichier téléversé avec succès !";
    } else {
        echo "Type de fichier non autorisé ou taille trop grande.";
    }
}
?&gt;</code></pre>
            </div>
        </section>

        <!-- Section Bypass des Mesures de Sécurité -->
        <section>
            <h2>Bypass des Mesures de Sécurité</h2>
            <p>
                Même avec des mesures de sécurité en place, un attaquant peut essayer de contourner les restrictions.
                Par exemple :
            </p>
            <ul>
                <li>Changer l'extension d'un fichier malveillant (ex: <code>shell.jpg.php</code>).</li>
                <li>Modifier l'en-tête MIME du fichier.</li>
            </ul>
            <p>
                Pour contrer cela, vous pouvez :
            </p>
            <ul>
                <li>Analyser le contenu du fichier pour vérifier son type réel.</li>
                <li>Utiliser des bibliothèques de sécurité comme <code>finfo_file</code> en PHP.</li>
            </ul>
        </section>

        <!-- Section Interactive -->
        <section>
            <h2>Exemple Interactif</h2>
            <form action="upload.php" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="file" class="form-label">Téléverser un fichier :</label>
                    <input type="file" class="form-control" id="file" name="file" required>
                </div>
                <button type="submit" class="btn btn-primary">Téléverser</button>
            </form>
        </section>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>